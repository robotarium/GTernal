ARG DOCKER_REGISTRY=0.0.0.0:9000
ARG BASE_IMAGE=base

FROM ${DOCKER_REGISTRY}/${BASE_IMAGE}

ARG FIRMWARE_REPO_USERNAME
ARG FIRMWARE_REPO_NAME
ARG FIRMWARE_REPO_BRANCH

# Load environment variables
ENV FIRMWARE_REPO_USERNAME=${FIRMWARE_REPO_USERNAME}
ENV FIRMWARE_REPO_NAME=${FIRMWARE_REPO_NAME}
ENV FIRMWARE_REPO_URL=https://github.com/${FIRMWARE_REPO_USERNAME}/${FIRMWARE_REPO_NAME}
ENV FIRMWARE_REPO_BRANCH=${FIRMWARE_REPO_BRANCH}

# Install firmware
ADD https://api.github.com/repos/${FIRMWARE_REPO_USERNAME}/${FIRMWARE_REPO_NAME}/git/refs/heads/${FIRMWARE_REPO_BRANCH} version.json
RUN git clone -b ${FIRMWARE_REPO_BRANCH} ${FIRMWARE_REPO_URL}
RUN cd GTernal && pip3 install .